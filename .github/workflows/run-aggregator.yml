name: Run Aggregator

on: push

jobs: 
  build:
      runs-on: ubuntu-latest
      steps:
      - name: Checkout Aggregator
        uses: actions/checkout@v4
        with:
          repository: samconley/newsatlas
          ref: main
          path: aggregator
          token: ${{ secrets.AGG_PAT }}
      - name: Install Dependencies
        run: |
          cd aggregator
          python -m pip install --upgrade pip
          pip install pipenv
          pipenv install
      - name: Run Python Program
        run: |
          cd aggregator
          pipenv run python main.py
        env:
          DB_WRITER_PASSWORD: ${{ secrets.DB_WRITER_PASSWORD }}